#
# XXX - doesn't compile, missing symbols
#   undefined reference to `ASN1_TIME_diff'
#   undefined reference to `ECDSA_SIG_get0_r'
#   undefined reference to `ECDSA_SIG_get0_s'
#   undefined reference to `EC_POINT_get_affine_coordinates'
#   undefined reference to `RSA_get0_e'
#   undefined reference to `RSA_get0_n'
#   undefined reference to `SSL_CTX_set_client_hello_cb'
# XXX - heavy openssl requirements on ualpn
#   echo '#define BN_RAND_BOTTOM_ANY 0' >> config.h
#   echo '#define BN_RAND_TOP_ANY -1' >> config.h
#   echo '#define NID_tlsfeature 1020' >> config.h
#   echo '#define SSL_CLIENT_HELLO_RETRY (-1)' >> config.h
#   echo '#define SSL_CLIENT_HELLO_SUCCESS 1' >> config.h
#   sed -i.ORG '/SSL_CTX_set_client_hello_cb/d' ualpn.c
#

rprovider="libressl"
rname="uacme${rprovider}"
rreqs="make curl${rprovider} ${rprovider} nghttp2 zlib pkgconfig"
. "${cwrecipe}/${rname%${rprovider}}/${rname%${rprovider}}tlsprovider.sh.common"

eval "
function cwconfigure_${rname}() {
  pushd \"${rbdir}\" >/dev/null 2>&1
  env PATH=\"${cwsw}/curl${rprovider}/current/devbin:\${PATH}\" \
    ./configure \
      ${cwconfigureprefix} ${rconfigureopts} ${rcommonopts} \
      --disable-docs \
      --with-libcurl=\"${cwsw}/curl${rprovider}/current\" \
      --with-openssl=\"${cwsw}/${rprovider}/current\" \
      --without-mbedtls \
      --without-gnutls \
      --without-ualpn \
        CPPFLAGS=\"\$(echo -I${cwsw}/{curl${rprovider},zlib,nghttp2,${rprovider}}/current/include)\" \
        LDFLAGS=\"\$(echo -L${cwsw}/{curl${rprovider},zlib,nghttp2,${rprovider}}/current/lib) -static\" \
        LIBS='-lcurl -lnghttp2 -lssh2 -lssl -lcrypto -lz -static' \
        PKG_CONFIG=\"${cwsw}/pkgconfig/current/bin/pkg-config\" \
        PKG_CONFIG_LIBDIR= \
        PKG_CONFIG_PATH=
  popd >/dev/null 2>&1
}
"

unset rprovider

# vim: set ft=sh:
