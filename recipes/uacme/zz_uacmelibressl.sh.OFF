#
# XXX - doesn't work, needs stock openssl for NID_tlsfeature, et al
#

rprovider="libressl"
rbase="uacme"
rname="${rbase}${rprovider}"
rver="$(cwver_${rbase})"
rdir="$(cwdir_${rbase})"
rfile="$(cwfile_${rbase})"
rdlfile="$(cwdlfile_${rbase})"
rurl="$(cwurl_${rbase})"
rreqs="make zlib ${rprovider} nghttp2 pkgconfig"
rprof="${cwetcprofd}/zz_${rname}.sh"
rsha256=""

. "${cwrecipe}/common.sh"

local f
for f in clean extract fetch ; do
  eval "
  function cw${f}_${rname}() {
    cw${f}_${rbase}
  }
  "
done
unset f

eval "
function cwconfigure_${rname}() {
  pushd \"${rbdir}\" >/dev/null 2>&1
  env PATH=\"${cwsw}/curllibressl/current/devbin:\${PATH}\" \
    ./configure \
      ${cwconfigureprefix} ${rconfigureopts} ${rcommonopts} \
      --disable-docs \
      --with-libcurl=\"${cwsw}/curllibressl/current\" \
      --with-openssl=\"${cwsw}/libressl/current\" \
      --without-gnutls \
      --without-mbedtls \
        CPPFLAGS=\"\$(echo -I${cwsw}/{curllibressl,zlib,nghttp2,libressl}/current/include)\" \
        LDFLAGS=\"\$(echo -L${cwsw}/{curllibressl,zlib,nghttp2,libressl}/current/lib) -static\" \
        LIBS='-lcurl -lssh2 -lnghttp2 -lz -lssl -lcrypto -static' \
        PKG_CONFIG=\"${cwsw}/pkgconfig/current/bin/pkg-config\" \
        PKG_CONFIG_LIBDIR= \
        PKG_CONFIG_PATH=
  popd >/dev/null 2>&1
}
"

eval "
function cwgenprofd_${rname}() {
  echo 'append_path \"${rtdir}/current/bin\"' > \"${rprof}\"
}
"

unset rbase rprovider
